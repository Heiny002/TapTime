<!DOCTYPE html>
<html>
<head>
    <title>Castle Battle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* Prevent text selection and zoom on mobile */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Allow text selection in input fields */
        input[type="text"] {
            -webkit-user-select: text;
            user-select: text;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            touch-action: manipulation;
        }

        /* Mobile-first responsive styles */
        @media (max-width: 768px) {
            #login-screen, #waiting-room, #strategy-screen {
                width: 95%;
                margin: 10px auto;
            }

            .button {
                padding: 12px 24px;
                font-size: 18px;
                width: 80%;
                max-width: 300px;
                margin: 10px auto;
                display: block;
            }

            input[type="text"] {
                width: 80%;
                max-width: 300px;
                font-size: 18px;
                padding: 12px;
                margin: 10px auto;
                display: block;
            }

            .team-container {
                width: 90%;
                height: auto;
                max-height: 40vh;
                position: fixed;
                right: 5%;
                top: 60px;
                z-index: 1000;
            }

            .battle-button {
                width: 90%;
                right: 5%;
                top: auto;
                bottom: 20px;
                padding: 16px;
                font-size: 18px;
                z-index: 1000;
            }

            .players-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 8px;
            }

            .tapper-name {
                padding: 12px;
                font-size: 16px;
            }

            .health-bar-container {
                transform: scale(1.2);
            }
        }

        #login-screen, #waiting-room, #strategy-screen {
            text-align: center;
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            display: none;
            position: relative;
        }

        #login-screen {
            display: block;
        }

        .button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 10px;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #45a049;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Waiting Room Styles */
        .waiting-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow: hidden;
        }

        .waiting-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            max-height: calc(70vh - 80px);
            overflow-y: auto;
            padding: 10px;
        }

        .tapper-name {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            background-color: #eee;
            transition: background-color 0.2s;
        }

        .tapper-name:hover {
            background-color: #e0e0e0;
        }

        .current-player {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }

        /* Strategy Room Styles */
        #strategy-screen {
            text-align: left;
            padding: 20px;
            position: relative;
        }

        .strategy-header {
            width: 100%;
            margin-bottom: 20px;
        }

        .team-info {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
        }

        .team-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .player-number {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            color: white;
        }

        .team-member {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            background-color: #f8f9fa;
            transition: background-color 0.2s;
        }

        .team-member.current-player {
            color: white;
        }

        .member-number {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
            color: white;
        }

        .team-container {
            width: 30%;
            height: 45vh;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            right: 20px;
            top: 200px;
            transition: transform 0.3s ease;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .strategy-header {
                padding: 10px;
            }

            .team-info {
                margin: 10px 0;
                padding: 12px;
            }

            .team-container {
                width: 90%;
                right: 5%;
                top: auto;
                bottom: 80px;
                padding: 10px;
                max-height: 40vh;
                transform-origin: bottom center;
            }

            .team-container.minimized {
                transform: translateY(calc(100% - 40px));
            }

            .minimize-button {
                position: absolute;
                top: 8px;
                right: 8px;
                width: 24px;
                height: 24px;
                border: none;
                background: none;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #666;
                cursor: pointer;
                z-index: 1002;
            }

            .team-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 8px;
                padding: 8px;
                overflow-y: auto;
                max-height: calc(40vh - 60px);
            }

            .team-member {
                padding: 8px;
                font-size: 14px;
            }

            .battle-button {
                bottom: 15px;
                height: 50px;
                margin: 0;
            }
        }

        .team-list {
            height: calc(100% - 30px);
            overflow-y: auto;
            padding: 10px;
        }

        .battle-button {
            position: fixed;
            right: 20px;
            width: 30%;
            top: calc(180px + 45vh + 60px);
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: all 0.3s ease;
            margin: 0;
           /* z-index: 100; */
        }

        .battle-button:hover {
            filter: brightness(1.1);
        }

        .health-bar-container {
            pointer-events: none;
            z-index: 1001;
        }

        .health-bar {
            transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        /* Scrollbar styling */
        .players-grid::-webkit-scrollbar,
        .team-list::-webkit-scrollbar {
            width: 6px;
        }

        .players-grid::-webkit-scrollbar-track,
        .team-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .players-grid::-webkit-scrollbar-thumb,
        .team-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .players-grid::-webkit-scrollbar-thumb:hover,
        .team-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Scrollbar styling */
        #players-list {
            scrollbar-width: thin;
            scrollbar-color: #1976d2 #f0f0f0;
        }
        
        #players-list::-webkit-scrollbar {
            width: 8px;
        }
        
        #players-list::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }
        
        #players-list::-webkit-scrollbar-thumb {
            background-color: #1976d2;
            border-radius: 4px;
            border: 2px solid #f0f0f0;
        }
        
        #players-list::-webkit-scrollbar-thumb:hover {
            background-color: #1565c0;
        }
        
        /* Container styling */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .players-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="login-screen">
        <h1>Castle Battle</h1>
        <input type="text" id="username" placeholder="Enter your username">
        <button class="button" onclick="joinGame()">Join Game</button>
    </div>

    <!-- 
    ⚠️ CRITICAL WARNING - PROTECTED CODE - DO NOT MODIFY ⚠️
    
    The waiting room layout and styling below is carefully crafted to:
    1. Provide a responsive grid layout that adapts to screen size
    2. Maintain proper spacing and visual hierarchy
    3. Handle player list updates efficiently
    4. Ensure consistent styling across devices
    
    Modifications to this code may break:
    - Player list display
    - Responsive behavior
    - Visual consistency
    - Grid layout functionality
    
    🔒 AUTHENTICATION REQUIRED 🔒
    Before modifying ANY waiting room code, you MUST:
    1. Document the specific issue requiring changes
    2. Get approval from the project maintainer
    3. Test changes thoroughly in all screen sizes
    -->
    <div id="waiting-room" style="display: none;">
        <h1>Waiting Room</h1>
        <div class="container" style="height: calc(100vh - 180px); padding: 20px; box-sizing: border-box;">
            <h2>Tappers</h2>
            <div class="players-container" style="height: calc(100% - 40px); background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; box-sizing: border-box; overflow: hidden;">
                <div id="players-list" style="width: 100%; height: 100%; overflow-y: auto;"></div>
            </div>
        </div>
        <button class="strategize-button" onclick="strategize()">Strategize</button>
    </div>
    <!-- END OF PROTECTED WAITING ROOM CODE -->

    <div id="strategy-screen">
        <div class="strategy-header">
            <h1>Strategy Room</h1>
            <div class="team-info" id="team-info">
                <!-- Team information will be displayed here -->
            </div>
        </div>
        <div class="team-container" id="team-container">
            <button class="minimize-button" id="minimize-button">−</button>
            <div class="title"></div>
            <div class="team-list" id="team-list">
                <!-- Team members will be dynamically added here -->
            </div>
        </div>
        <button class="button battle-button" onclick="startGame()">Start Battle</button>
    </div>

    <div id="game-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #87CEEB; z-index: 1000;">
        <div id="health-bars" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1001;"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="game.js"></script>
    <script>
        // Add event listener for return key on username input
        document.getElementById('username').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                joinGame();
            }
        });

        // Add event listener for castle clicks
        window.addEventListener('click', onCastleClick);

        // Add minimize functionality for team container
        document.addEventListener('DOMContentLoaded', function() {
            const minimizeButton = document.getElementById('minimize-button');
            const teamContainer = document.getElementById('team-container');
            
            if (minimizeButton && teamContainer) {
                minimizeButton.addEventListener('click', function() {
                    teamContainer.classList.toggle('minimized');
                    minimizeButton.textContent = teamContainer.classList.contains('minimized') ? '+' : '−';
                });
            }
        });
    </script>
</body>
</html> 